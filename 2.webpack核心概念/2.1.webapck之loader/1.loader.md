#### webpack核心之loader
webpack默认会对以.js结尾的文件进行打包，如果需要对非.js结尾的文件进行打包，就需要loader的辅助。
##### 1. 什么是loader
官网中对loader的描述，webpack可以使用loader对文件进行'预处理'，允许打包除JavaScript之外的所有静态资源。
![loader是什么](./imgs/1.loader-concept.png)

##### 2. loader初体验
###### 2.1 loader打包图片文件
如果我们还按照跟js文件一样对**图片**进行引入然后打包，此时就会报错。
- 打包图片文件
  1. 编写index.js文件，引入图片文件
    ![引入图片文件](./imgs/3.import-png.png)
  2. 然后运行命令npx webpack，此时就会报错。
    ![运行编译命令](./imgs/2.error-png.png)
    错误中提示需要使用loader去处理此类文件。
  3. 通过命令安装**file-loader**。
    ```
      npm install file-loader -D
    ```
  4. 在webapck.config.js中配置file-loader。
    ![配置file-loader](./imgs/4.file-loader.png)
  5. 再次运行npx webpack编译，打包结果正确并生成对应的dist目录。
    ![打包成功](./imgs/5.success-result.png)
  6. 打包生成的对应的dist目录。
    ![dist目录](./imgs/6.dist-dir.png)
    **注意**：
      对于生成的复杂的图片文件名是可以配置的，在下文会讲到。
- 打包过程
  - 运行命令npx webpack
    1. webpack会根据webpack.config.js进行配置打包，如果遇到.js文件webpack本身就知道如何进行打包。
    2. 当遇到.png文件时，配置文件中module配置项告诉webapck使用file-loader进行打包。
    3. file-loader知道如何对.png文件进行打包，首先会将需要打包的文件拷贝到对应的dist文件中，并且将文件在dist中的文件名返回给引入的变量。
      ![图片名称](./imgs/7.file-name.png)

- file-loader配置选项
  默认生成的文件名是文件内容的 MD5 哈希值和原始文件扩展名，默认生成的文件名很不友好，我们可以通过配置选项进行修改。
  - 选项：name
    - 常用占位符
      - name 
        资源基本名称
      - ext
        资源扩展名
    - 配置webapck.config.js修改生成文件名称。
      ![修改文件名称](./imgs/8.option-name.png)
    - 设置文件生成路径
      如果不希望文件打包生成在dist根目录下，可以通过outputPath进行配置。
      ![修改文件名称](./imgs/9.file-dir.png)
   
- url-loader
  url-loader功能类似file-loader，当打包的文件大小小于设置的限制时，返回一个DataURL。
  - 替换file-loader打包图片
    1. 安装url-loader依赖
    ```
      npm install url-loader -D
    ```
    2. 配置webpack.config.js
    ![配置url-loader](./imgs/10.url-loader.png)
    这样打包后，dist目录中就不会再有单独的图片文件。图片文件会以base64形式的字符串保存。
    ![base64](./imgs/11.base64.png)
    
    3. url-loader配置选项
      - 优点
        使用url-loader对图片打包后，不会再dist目录中生成单独的图片，图片会以base64的形式打包到.js中，这样页面在加载图片的时候就会减少一次http请求。
      - 缺点
        如果图片相对比较大，就会导致js文件偏大，这样页面的加载就需要耗费更多的时间。
      - 解决方法：
        1. 当图片大小小于一定值时候，救将图片以base64的形式进行打包存储。
        2. 当图片大于等于某个值时，还是生成一个新图片。
      - limit选项
        url-loader中的limit选项就可以很好的解决上面的问题。
        - 配置limit选项
          ![limit](./imgs/11.limit.png)
          由于我们原图大小为18kb，所以最后打包生成了新的图片。
        - 修改limit值为18kb
          ![limit-change](./imgs/12.limit-change.png)
          当我们修改limit大小为18kb时，打包后图片就以base64的形式存储。
          ![base64](./imgs/11.base64.png)

###### 2.1 loader打包样式文件
  学习了图片文件的打包，那么对于css/less/scss等样式文件如何进行打包呢。
  1. 编写index.css文件，在index.js中引入index.css文件，编译打包时候报错。
    ![css-loader报错](./imgs/13.css-loader-error.png)
    错误中提示需要正确的loader去处理css类型文件。
  2. 安装style-loader和css-loader。
  ```
    npm install style-loader css-loader -D
  ```
   - style-loader
      负责将css文件注入到html的head中。
   - css-loader
      css-loader会分析互相引用的css之间的关系，并将所有的css进行合并压缩为一个。
  3. 配置style-loader和css-loader。
    ![css-loader配置](./imgs/14.css-loader-config.png)
    我们可以看到页面上的图片尺寸已经改变了。
    ![css-loader配置成功](./imgs/15.css-loader-suc.png)

    